@page "/materiais/{Category}/addMaterial"
@using Microsoft.AspNetCore.Authorization
@using Shared.DTOs
@attribute [Authorize(Roles = "Master, User")]
@inject HttpClient Http
@inject NavigationManager Nav

<h3>Add Material - @Category</h3>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger">@errorMessage</div>
}

@if (!string.IsNullOrEmpty(successMessage))
{
    <div class="alert alert-success">@successMessage</div>
}

<div class="mb-3">
    <label>Material Name</label>
    <input class="form-control" @bind="Name" />
</div>

<div class="mb-3">
    <label>Quantity</label>
    <input type="number" class="form-control" @bind="Quantity" min="0" />
</div>

<div class="mb-3">
    <label>Cost (R$)</label>
    <input type="number" step="0.01" class="form-control" @bind="Cost" min="0" />
</div>

<div class="mb-3">
    <label>Total (R$)</label>
    <input type="number" step="0.01" class="form-control" @bind="Total" min="0" />
</div>

<button class="btn btn-success" @onclick="Create">Save</button>
<button class="btn btn-secondary ms-2" @onclick="Cancel">Cancel</button>

@code {
    [Parameter] public string Category { get; set; } = string.Empty;
    private string Name = "";
    private int Quantity = 0;
    private decimal Cost = 0;
    private decimal Total = 0;
    private string? errorMessage;
    private string? successMessage;

    async Task Create()
    {
        errorMessage = null;
        successMessage = null;

        if (string.IsNullOrWhiteSpace(Name))
        {
            errorMessage = "Por favor, informe o nome do material.";
            return;
        }

        if (Quantity <= 0)
        {
            errorMessage = "A quantidade deve ser maior que zero.";
            return;
        }

        var request = new MaterialCreateRequest(Name, Category, Quantity, Cost, Total);
        var result = await Http.PostAsJsonAsync("materials", request);

        if (result.IsSuccessStatusCode)
        {
            successMessage = "Material adicionado com sucesso!";
            await Task.Delay(1000);
            Nav.NavigateTo($"/materiais/{Category}");
        }
        else
        {
            var errorContent = await result.Content.ReadAsStringAsync();
            errorMessage = errorContent;
        }
    }

    void Cancel()
    {
        Nav.NavigateTo($"/materiais/{Category}");
    }
} 
